/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojcontext","ojs/ojconfig","ojs/ojcomponentcore","ojs/ojattributegrouphandler","ojs/ojlocaledata","ojs/ojvalidation-base","ojs/ojvalidation-number","ojs/internal-deps/dvt/DvtToolkit","ojs/ojkeysetimpl","ojs/ojmap","ojs/ojlogger","ojdnd","promise"],function(e,t,n,r,i,o,a,s,l,h,d,u,_){e.AttributeGroupHandler=o.AttributeGroupHandler,e.ColorAttributeGroupHandler=o.ColorAttributeGroupHandler,e.ShapeAttributeGroupHandler=o.ShapeAttributeGroupHandler;var c={_SHAPE_REGEXP:/\d/,_SHAPE_ENUMS:{circle:!0,ellipse:!0,square:!0,rectangle:!0,diamond:!0,triangleUp:!0,triangleDown:!0,plus:!0,human:!0,star:!0},shapeParseFunction:function(e,t){var n=t||c._SHAPE_ENUMS;return function(t,r,i,o){if(e[r]){if(c._SHAPE_REGEXP.test(t))return t;if(n[t])return t;throw new Error("Found: '"+t+"'. Expected one of the following: "+Object.keys(n).toString())}return o(t)}}},p=function(e,t){this._path=t,this._root=e,this._delimiter="/"};p.prototype._resolveLeafObjectAndProperty=function(e,t,n,r){for(var i={};e&&t.indexOf(n)>-1;){var o=t.substring(0,t.indexOf(n));r&&void 0===e[o]&&(e[o]={}),e=e[o],t=t.substring(t.indexOf(n)+1,t.length)}return e&&(i.object=e,i.parameter=t),i},p.prototype._resolvePath=function(e){if(void 0===this._leaf){var t=this._resolveLeafObjectAndProperty(this._root,this._path,this._delimiter,e);this._leaf=t.object,this._param=t.parameter}},p.prototype.getValue=function(){return this._resolvePath(!1),void 0===this._leaf?void 0:this._leaf[this._param]},p.prototype.setValue=function(e,t){this._resolvePath(!0),!t&&this._leaf[this._param]||(this._leaf[this._param]=e)};var v={TEXT:function(e){var t={};return e&&(e.hasClass("oj-gauge-metric-label")?(t["font-size"]=!0,t.color=!0):e.hasClass("oj-treemap-node-header")&&(t["font-weight"]=!0)),v._buildTextCssPropertiesObject(e,t)},BACKGROUND:function(e,t,n,r){return v._buildCssBackgroundPropertiesObject(e)},ANIM_DUR:function(e){var t=e.css("animation-duration");if(t)return"ms"===t.slice(-2)?t=parseInt(t.slice(0,-2),10):"s"===t.slice(-1)&&(t=1e3*parseFloat(t.slice(0,-1))),t},_INHERITED_FONT_COLOR:"rgb(254, 0, 254)",_INHERITED_FONT_FAMILY:"Times",_INHERITED_FONT_SIZE:"1px",_INHERITED_FONT_WEIGHT:"1",_INHERITED_FONT_STYLE:"normal",_FONT_SIZE_BUFFER:4,_styleCache:{},defaultStyleProcessor:function(e,t){return e.css(t)},_buildCssBackgroundPropertiesObject:function(e){var t={};return e.css("border-top-color")&&(t.borderColor=e.css("border-top-color")),e.css("border-width")&&e.css("border-style")&&"none"!==e.css("border-style")&&(t.borderWidth=e.css("border-width")),e.css("background-color")&&(t.backgroundColor=e.css("background-color")),t},_buildTextCssPropertiesObject:function(e,t){var n={},r=e.css("font-family");return r&&r!==v._INHERITED_FONT_FAMILY&&(n.fontFamily=r.replace(/"/g,"'")),!(r=e.css("font-size"))||r.indexOf("px")>-1&&parseFloat(r)<v._FONT_SIZE_BUFFER||t["font-size"]||(n.fontSize=r),(r=e.css("font-weight"))&&r!==v._INHERITED_FONT_WEIGHT&&!t["font-weight"]&&(n.fontWeight=r),(r=e.css("color"))&&r!==v._INHERITED_FONT_COLOR&&!t.color&&(n.color=r),(r=e.css("font-style"))&&r!==v._INHERITED_FONT_STYLE&&(n.fontStyle=r),n},processStyles:function(e,n,r,i){var a,s=null,l=null,h="";for(a=0;a<r.length;a++)h=h+r[a]+" ";var d,u={},_={},c=Object.keys(i);for(a=0;a<c.length;a++){var p=i[d=c[a]];p instanceof Array||(p=[p]);var f=v._hasUncachedProperty(d,p);l||s||!f||((s=t(document.createElement("div"))).attr("style","display:none;"),e.append(s),s.attr("class",h),t(document.body).append(s),(l=t(document.createElement("div"))).css("font-size",v._INHERITED_FONT_SIZE),l.css("color",v._INHERITED_FONT_COLOR),l.css("font-weight",v._INHERITED_FONT_WEIGHT),l.css("font-style",v._INHERITED_FONT_STYLE),s.append(l)),u[d]=p,f&&(_[d]=v._createStyleDivs(l,d,p))}var m=o.ColorAttributeGroupHandler.__createAttrDiv();for(a=0;a<c.length;a++)d=c[a],v._processStyle(_[d],n,d,u[d]);m&&(o.ColorAttributeGroupHandler.__processAttrDiv(m),m.remove()),s&&s.remove()},_createStyleDivs:function(e,n,r){v._styleCache[n]||(v._styleCache[n]={});for(var i=null,o=0;o<r.length;o++){var a=r[o].property;if(a)void 0===v._styleCache[n][a]&&(i||((i=t(document.createElement("div"))).addClass(n),e.append(i)))}return i},_processStyle:function(e,t,n,r){for(var i=0;i<r.length;i++){var o=r[i],a=o.property;if(a){var s=v._styleCache[n][a];if(void 0===s&&e&&(s=v._resolveStyle(e,a),v._styleCache[n][a]=s),null!=s){var l=new p(t,o.path),h=l.getValue(),d="object"==typeof h;if(d&&h)for(var u=Object.keys(s),_=0;_<u.length;_++){var c=u[_];void 0===h[c]&&(h[c]=s[c])}else l.setValue(s,d)}}}},_resolveStyle:function(e,t){var n=v[t],r=n?n(e):v.defaultStyleProcessor(e,t);return null==r||"string"==typeof r&&""===r.replace(/^\s+/g,"")?null:r},_hasUncachedProperty:function(e,t){var n=v._styleCache[e];if(!n)return!0;for(var r=0;r<t.length;r++){var i=t[r].property;if(i)if(void 0===n[i])return!0}return!1}};return e.__registerWidget("oj.dvtBaseComponent",t.oj.baseComponent,{options:{trackResize:"on"},_ComponentCreate:function(){this._super(),this._renderCount=0,this._numDeferredObjs=0,this._optionsCopy=null,this._templateMap={},this._dataProviderState={},this._treeKeyDataMap={},this._dpNodeContextData={},this._dpNodeValueData={},this._dataValuePromise={};for(var n=this._GetComponentStyleClasses(),r=0;r<n.length;r++)this.element.addClass(n[r]);this._referenceDiv=t(document.createElement("div")),this._referenceDiv.attr("style","visibility:hidden;"),this.element.append(this._referenceDiv);var o=this.element[0].parentElement;o&&o._dvtcontext?this._context=o._dvtcontext:this._context=new h.Context(this.element[0],null,this._referenceDiv[0]),this._context.oj=e,this._context.KeySetImpl=d,this._context.ojMap=u,this._context.dataProviderProps=Object.keys(this._GetSimpleDataProviderConfigs()),this._context.setReadingDirection(this._GetReadingDirection()),this._context.setTooltipAttachedCallback(i.subtreeAttached),this._context.setOverlayAttachedCallback(i.subtreeAttached),this._context.setTooltipStyleClass("oj-dvt-tooltip"),this._context.setDatatipStyleClass("oj-dvt-datatip"),this._context.setFixContextCallback(this._FixRendererContext.bind(this)),this._context.setCustomElement(this._IsCustomElement()),t(document.body).hasClass("oj-hicontrast")&&h.Agent.setHighContrast(!0),this._component=this._CreateDvtComponent(this._context,this._HandleEvent,this),this._context.getStage().addChild(this._component),!1!==h.requireJS&&(this._setLocaleHelpers(),this._processTranslations()),this._LoadResources(),this._dataProviderEventListeners=[],this.options._environment="jet",this.options._widgetConstructor=i.__GetWidgetConstructor(this.element)},_AfterCreate:function(){this._super(),"off"!==this.options.trackResize&&this._addResizeListener(),this._ProcessOptions(),this._Render()},refresh:function(){this._super(),this._context.setReadingDirection(this._GetReadingDirection()),this._processTranslations(),this._Render()},getNodeBySubId:function(e){var t=this._component&&this._component.getAutomation?this._component.getAutomation():null;if(t){var n=this._ConvertLocatorToSubId(e);return t.getDomElementForSubId(n)}return null},getSubIdByNode:function(e){var t=this._component&&this._component.getAutomation?this._component.getAutomation():null;if(t){var n=t.getSubIdForDomElement(e);return n?this._ConvertSubIdToLocator(n):null}return null},_ConvertLocatorToSubId:function(e){return null},_ConvertSubIdToLocator:function(e){return null},_ProcessStyles:function(){v.processStyles(this.element,this.options,this._GetComponentStyleClasses(),this._GetChildStyleClasses())},_GetComponentStyleClasses:function(){return["oj-dvtbase"]},_GetChildStyleClasses:function(){var e={"oj-dvt-no-data-message":{path:"_statusMessageStyle",property:"TEXT"}};return e},_GetEventTypes:function(){return[]},_GetTranslationMap:function(){var e=this.options.translations,t={"DvtUtilBundle.CLEAR_SELECTION":e.labelClearSelection,"DvtUtilBundle.COLON_SEP_LIST":e.labelAndValue,"DvtUtilBundle.INVALID_DATA":e.labelInvalidData,"DvtUtilBundle.NO_DATA":e.labelNoData,"DvtUtilBundle.DATA_VISUALIZATION":e.labelDataVisualization,"DvtUtilBundle.STATE_SELECTED":e.stateSelected,"DvtUtilBundle.STATE_UNSELECTED":e.stateUnselected,"DvtUtilBundle.STATE_MAXIMIZED":e.stateMaximized,"DvtUtilBundle.STATE_MINIMIZED":e.stateMinimized,"DvtUtilBundle.STATE_EXPANDED":e.stateExpanded,"DvtUtilBundle.STATE_COLLAPSED":e.stateCollapsed,"DvtUtilBundle.STATE_ISOLATED":e.stateIsolated,"DvtUtilBundle.STATE_HIDDEN":e.stateHidden,"DvtUtilBundle.STATE_VISIBLE":e.stateVisible,"DvtUtilBundle.SCALING_SUFFIX_THOUSAND":e.labelScalingSuffixThousand,"DvtUtilBundle.SCALING_SUFFIX_MILLION":e.labelScalingSuffixMillion,"DvtUtilBundle.SCALING_SUFFIX_BILLION":e.labelScalingSuffixBillion,"DvtUtilBundle.SCALING_SUFFIX_TRILLION":e.labelScalingSuffixTrillion,"DvtUtilBundle.SCALING_SUFFIX_QUADRILLION":e.labelScalingSuffixQuadrillion},n=a.getMonthNames("abbreviated");return t["DvtUtilBundle.MONTH_SHORT_JANUARY"]=n[0],t["DvtUtilBundle.MONTH_SHORT_FEBRUARY"]=n[1],t["DvtUtilBundle.MONTH_SHORT_MARCH"]=n[2],t["DvtUtilBundle.MONTH_SHORT_APRIL"]=n[3],t["DvtUtilBundle.MONTH_SHORT_MAY"]=n[4],t["DvtUtilBundle.MONTH_SHORT_JUNE"]=n[5],t["DvtUtilBundle.MONTH_SHORT_JULY"]=n[6],t["DvtUtilBundle.MONTH_SHORT_AUGUST"]=n[7],t["DvtUtilBundle.MONTH_SHORT_SEPTEMBER"]=n[8],t["DvtUtilBundle.MONTH_SHORT_OCTOBER"]=n[9],t["DvtUtilBundle.MONTH_SHORT_NOVEMBER"]=n[10],t["DvtUtilBundle.MONTH_SHORT_DECEMBER"]=n[11],t},_VerifyConnectedForSetup:function(){return!0},_SetupResources:function(){this._super(),this._addDataProviderEventListeners()},_ReleaseResources:function(){this._super(),this._removeDataProviderEventListeners()},_processTranslations:function(){var e=this._GetTranslationMap();h.Bundle.addLocalizedStrings(e)},_setLocaleHelpers:function(){var e={};e.numberConverterFactory=s.Validation.getDefaultConverterFactory("number"),e.isoToDateConverter=function(e){if("string"==typeof e){var t=s.IntlConverterUtils.isoToDate(e),n=t.toJSON()?s.IntlConverterUtils.dateToLocalIso(t):e;return s.IntlConverterUtils.isoToLocalDate(n)}return e},e.dateToIsoWithTimeZoneConverter=function(e){if(e instanceof Date){var t=-1*e.getTimezoneOffset(),n=t>=0?"+":"-",r=Math.floor(Math.abs(t)/60),i=Math.abs(t)%60,o=n+(2!==r.toString().length?"0"+r:r)+":"+(2!==i.toString().length?i+"0":i);return s.IntlConverterUtils.dateToLocalIso(e)+o}return e},this._context.setLocaleHelpers(e)},_destroy:function(){this._context.hideTooltips(),this._context.destroy(),this._context=null;var e=this.element[0].parentElement;e&&e._dvtcontext&&(e._dvtcontext=null),this._component.destroy&&this._component.destroy(),this._component=null,this._removeResizeListener(),this._CleanAllTemplates(),this.element.children().remove(),this.element.removeAttr("role").removeAttr("tabIndex").removeAttr("aria-activedescendant");for(var t=this._GetComponentStyleClasses(),n=0;n<t.length;n++)this.element.removeClass(t[n]);this._MakeReady(),this._dataProviderState={},this._treeKeyDataMap={},this._dpNodeContextData={},this._dpNodeValueData={},this._dataValuePromise={},this._super()},_setOptions:function(e,n){this._superApply(arguments),this._OptionChangeHandler(e);var r=this.options.trackResize;if("off"===r&&this._resizeListener?this._removeResizeListener():"off"===r||this._resizeListener||this._addResizeListener(),this._ProcessOptions(),!this._bUserDrivenChange){var i=!1,o=this._GetEventTypes(),a=["highlightedCategories","selection","dataCursorPosition","scrollPosition"];t.each(e,function(e){if(o.indexOf(e)<0&&a.indexOf(e)<0)return i=!0,!1}),i?this._Render():(void 0!==e.highlightedCategories&&this._component.highlight(e.highlightedCategories),void 0!==e.selection&&this._component.select(e.selection),void 0!==e.dataCursorPosition&&this._component.positionDataCursor&&this._component.positionDataCursor(e.dataCursorPosition),void 0!==e.scrollPosition&&this._component.scroll(e.scrollPosition))}},_CreateDvtComponent:function(e,t,n){return null},_HandleEvent:function(e){var n=e.type;"selection"===n?this._UserOptionChange("selection",e.selection):"categoryHide"===n||"categoryShow"===n?this._UserOptionChange("hiddenCategories",e.hiddenCategories):"categoryHighlight"===n?this._UserOptionChange("highlightedCategories",e.categories):"optionChange"===n?this._UserOptionChange(e.key,e.value,e.optionMetadata):"touchHoldRelease"===n&&this._GetContextMenu()?this._OpenContextMenu(t.Event(e.nativeEvent),"touch"):"ready"===n&&0===this._numDeferredObjs&&this._MakeReady()},_addResizeListener:function(){this._resizeListener||(this._resizeListener=this._handleResize.bind(this),e.DomUtils.addResizeListener(this.element[0],this._resizeListener,250))},_removeResizeListener:function(){this._resizeListener&&(e.DomUtils.removeResizeListener(this.element[0],this._resizeListener),this._resizeListener=null)},_handleResize:function(e,t){var n=this.element.width(),r=this.element.height();(null==this._width||null==this._height||Math.abs(n-this._width)+Math.abs(r-this._height)>=5)&&this._Render(!0)},_LoadResources:function(){},_Render:function(e){this._context.hideTooltips(),this._NotReady(),!this._context.isReadyToRender()||this._renderNeeded&&e?(this._renderNeeded=!0,this._MakeReady()):(this._width=this._IsFlowingLayoutSupported()?null:this.element.width(),this._height=this._IsFlowingLayoutSupported()?null:this.element.height(),this._context.setDefaultFontFamily(this._referenceDiv.css("font-family")),this.options._width=this._width,this.options._height=this._height,this.options._locale=r.getLocale(),this._IsDraggable()&&this.element.attr("draggable",!0),this._ProcessStyles(),e?0===this._numDeferredObjs&&(this._renderCount+=1,this._RenderComponent(this._optionsCopy,e)):(this._renderCount+=1,this._resolveDeferredDataItems()&&this._RenderComponent(this._optionsCopy)),this._renderNeeded=!1)},_IsDraggable:function(){return!!this.options.dnd},_NotifyShown:function(){this._super(),this._notifyShownAttached()},_NotifyAttached:function(){this._super(),this._notifyShownAttached()},_NotifyDetached:function(){this._super(),this._notifyHiddenDetached()},_NotifyHidden:function(){this._super(),this._notifyHiddenDetached()},_notifyShownAttached:function(){this._renderNeeded&&this._Render()},_notifyHiddenDetached:function(){this._context.hideTooltips(),this._MakeReady()},_UserOptionChange:function(e,t,n){this._bUserDrivenChange=!0,this.option(e,t,{_context:{writeback:!0,optionMetadata:n,internalSet:!0}}),this._bUserDrivenChange=!1},_NotifyContextMenuGesture:function(e,t,n){if("touch"!==n)if("keyboard"===n){var r=this.element[0].getBoundingClientRect(),i=this._component.getKeyboardFocus()?this._component.getKeyboardFocus().getBoundingClientRect():null,o=i?"left+"+(i.left+.5*i.width-r.left)+" top+"+(i.top+.5*i.height-r.top):"center";this._OpenContextMenu(t,n,{position:{at:o}})}else this._super(e,t,n)},_GetDvtComponent:function(e){var t=i.__GetWidgetConstructor(e)("instance");return t?t._component:null},_GetStringFromIndexPath:function(e){for(var t="",n=0;n<e.length;n++)t+="["+e[n]+"]";return t},_GetIndexPath:function(e){for(var t=[],n=0;e.indexOf("[",n)>0;){var r=e.indexOf("[",n)+1,i=e.indexOf("]",n);t.push(Number(e.substring(r,i))),n=i+1}return t},_GetFirstIndex:function(e){return Number(this._GetFirstBracketedString(e))},_GetFirstBracketedString:function(e){var t=e.indexOf("[")+1,n=e.indexOf("]");return e.substring(t,n)},_GetComponentDeferredDataPaths:function(){return{}},_GetComponentNoClonePaths:function(){if(!this._noClonePaths){this._noClonePaths={};var e=this,t=this._GetComponentDeferredDataPaths().root;t&&t.forEach(function(t){e._noClonePaths[t]=!0})}return this._noClonePaths},_resolveDeferredDataItems:function(){this._optionsCopy=h.JsonUtils.clone(this.options,null,this._GetComponentNoClonePaths()),this._FixCustomRenderers(this._optionsCopy),this._numDeferredObjs=0;for(var e=this,t=this._GetComponentDeferredDataPaths(),n=Object.keys(t),r=0;r<n.length;r++){var i=n[r];t[i].forEach(function(t){if("root"===i)e._resolveDeferredDataItem.bind(e)(e.options,e._optionsCopy,t);else{var n=e.options[i];if(n&&n instanceof Array)for(var r=0;r<n.length;r++)e._resolveDeferredDataItem.bind(e)(n[r],e._optionsCopy[i][r],t)}})}return 0===this._numDeferredObjs},_resolveDeferredDataItem:function(t,n,r){var i=new p(t,r),o=i.getValue(),a=this;if(o instanceof Function?o=Promise.resolve(o(this._GetDataContext(t))):this._IsCustomElement()&&Array.isArray(o)&&(o=Promise.resolve(o),i.setValue(o,!0)),o&&e.DataProviderFeatureChecker.isDataProvider(o)){var s=e.DataProviderFeatureChecker.isTreeDataProvider(o);o=a._dataValuePromise[r]||new Promise(function(e){var t=a._getTemplateEngine(),n=a._dataProviderState[r]||{},i=n.data?Promise.resolve(n.data):a._fetchAllData(o,r);Promise.all([t,i]).then(function(t){var i=t[0],o=t[1];n.data=o,a._dataProviderState[r]=n;var l=n.pathsValuesMap?n.pathsValuesMap:a._ProcessTemplates(r,o,i,s);a._dataValuePromise[r]=null,e(l)},function(){a._dataValuePromise[r]=null})}),a._dataValuePromise[r]=o}if(o instanceof Promise){var l=this._renderCount;o.then(function(e){var t=[r],i=[e];e.paths&&(t=e.paths,i=e.values,a._dataProviderState[r].pathsValuesMap=e),a._renderDeferredData(l,n,t,i)},function(){a._renderDeferredData(l,n,[r],[[]])}),this._numDeferredObjs+=1}},_renderDeferredData:function(e,t,n,r){if(e===this._renderCount){this._numDeferredObjs-=1;for(var i=0;i<n.length;i++)new p(t,n[i]).setValue(r[i],!0);0===this._numDeferredObjs&&(this._RenderComponent(this._optionsCopy),this._optionsCopy=null)}},_ClearDataProviderState:function(e){this._dataProviderState[e]={},this._dataValuePromise[e]=null},_OptionChangeHandler:function(e){for(var t=Object.keys(this._dataProviderState),n=0;n<t.length;n++){var r=t[n];Object.prototype.hasOwnProperty.call(e,r)&&this._ClearDataProviderState(r)}},_fetchCollection:function(t,n,r,i,o,a){var s=this,l={data:[],keys:[]};if(a<=-1)return Promise.resolve(l);var h=t.fetchFirst({size:-1})[Symbol.asyncIterator](),d=e.DataProviderFeatureChecker.isTreeDataProvider(t),u=function(e){for(var t=[],a=0;a<e.value.data.length;a++){var _=n({data:e.value.data[a],key:e.value.metadata[a].key},o);t.push(_)}return Promise.all(t).then(function(e){for(var t=0;t<e.length;t++){var n=e[t].data,o=e[t].key;l.data.push(n),l.keys.push(o),s._treeKeyDataMap[r].set(d?o.value:o,{data:n,key:o,parentKey:i})}}).then(function(){return e.done?Promise.resolve(l):h.next().then(u)})};return h.next().then(u)},_getDPPostProcessor:function(t,n,r,i){var o=this,a=e.DataProviderFeatureChecker.isTreeDataProvider(t);i=null==i?Number.MAX_VALUE:i;var s=function(e,a){var l={value:e.data},h={value:e.key};if(a<i&&r&&r.has(h.value)){var d=t.getChildDataProvider(h.value);if(d)return o._fetchCollection(d,s,n,h.value,a+1).then(function(e){return l.children=e.data,h.children=e.keys,{data:l,key:h}})}return Promise.resolve({data:l,key:h})};return a?s:function(e){return Promise.resolve(e)}},_fetchAllData:function(e,t){var n=this._GetSimpleDataProviderConfigs()[t];return this._treeKeyDataMap[t]=this._treeKeyDataMap[t]||new u,this._dpNodeContextData[t]=this._dpNodeContextData[t]||new u,this._dpNodeValueData[t]=this._dpNodeValueData[t]||new u,this._fetchCollection(e,this._getDPPostProcessor(e,t,n.expandedKeySet,n.maxFetchDepth),t,null,0,n.maxFetchDepth)},_getTemplateEngine:function(){return this._templateEnginePromise?this._templateEnginePromise:(this._templateEnginePromise=new Promise(function(e){r.__getTemplateEngine().then(function(t){e(t)},function(e){throw new Error("Error loading template engine: "+e)})}),this._templateEnginePromise)},getTemplates:function(){return e.BaseCustomElementBridge.getSlotMap(this.element[0])},getElementPropertyNames:function(t){var n=e.CustomElementBridge.getMetadata(t).properties,r=Object.keys(n).filter(function(e){return!n[e]._eventListener}),i=new Set;return r.forEach(function(e){i.add(e)}),i},getPropertyValidator:function(t,n){if(!t)return null;var r=e.CustomElementBridge.getMetadata(n),i=t.content?t.content.children[0]:t.childNodes[1],o={};return function(t,n){var a=t.join("."),s=o[a];if(!s){s=r;for(var l=0;l<t.length;l++)s=s.properties[t[l]];o[a]=s}e.BaseCustomElementBridge.checkEnumValues(i,a,n,s),null!=n&&e.BaseCustomElementBridge.checkType(i,a,n,s)}},_ProcessTemplates:function(e,t,n,r,i){var o,a,s=this._GetSimpleDataProviderConfigs()[e],l=this;if(s){o=[],a=[];var h="string"==typeof s.templateName?function(){return s.templateName}:s.templateName,d="string"==typeof s.templateElementName?function(){return s.templateElementName}:s.templateElementName,u=s.resultPath,c=this.options.as,p=this.getTemplates(),v=this.element[0],f=s.getAliasedPropertyNames,m=s.processChildrenData,g=s.processOptionData||function(e){return e},y={},D=l._dpNodeContextData[e];if(h&&d&&u){var C,E={},T=function(e,t,r,i,o,a){var s,h=E[o];h||(h=l.getElementPropertyNames(o),E[o]=h);try{if(i){if(s=n.resolveProperties(v,i[0],o,h,r,c,a),f)for(var d=f(o),u=Object.keys(d),p=0;p<u.length;p++){var m=u[p];s[d[m]]=s[m],s[m]=void 0}}else s={};s.id=t,s._itemData=e}catch(e){_.error(e)}return s},P=function(t,n,i){for(var o=t.data,a=t.keys,s=[],_=0;_<o.length;_++){var c=r?o[_].value:o[_],f=r?a[_].value:a[_],g={data:c,key:f,index:_,componentElement:v};r&&(g.parentData=n,g.parentKey=i),D.set(f,g);var C=h(o[_]),E=d(o[_]),S=p[C],b=y[E];!b&&S&&(b=l.getPropertyValidator(S[0],E),y[E]=b);var O=T(c,f,g,S,E,b);if(o[_].children){var R=n.slice(0);R.push(c);var N={data:o[_].children,keys:a[_].children},I=P(N,R,f);m?m(O,o[_],I):O[u]=I}l._dpNodeValueData[e].set(f,O),s.push(O)}return s};o.push(u),i&&D.has(i)&&(C=D.get(i).parentData.concat(D.get(i).data));var S=P(t,C||[],i);a.push(g(S))}}return{paths:o,values:a}},_GetFetchDataHandler:function(e){var t=this,n=t._GetSimpleDataProviderConfigs()[e].resultPath;return function(r,i,o,a){var s=r.getChildDataProvider(a);if(s){var l=t._GetSimpleDataProviderConfigs()[e].maxFetchDepth,h=t._dpNodeContextData[e].get(a).parentData.length,d=t._getDPPostProcessor(r,e,i,l),u=t._fetchCollection(s,d,e,a,h,l),_=t._getTemplateEngine();return Promise.all([_,u]).then(function(r){var i,s,l,h,d=r[0],u=r[1].data,_=r[1].keys,c=t._ProcessTemplates(e,{data:u,keys:_},d,!0,a).values[0];return i=a,s=u,l=_,h=c,t._treeKeyDataMap[e].get(i).data.children=s,t._treeKeyDataMap[e].get(i).key.children=l,t._dpNodeValueData[e].get(i)[n]=h,o&&(o[n]=c),c})}return Promise.resolve()}},_GetSimpleDataProviderConfigs:function(){return{}},_RenderComponent:function(e,t){if(this._context.isReadyToRender()){this._CleanAllTemplates();var n=this._IsFlowingLayoutSupported()&&this._resizeListener;n&&this._removeResizeListener(),this._component.render(t?null:e,this._width,this._height),n&&this._addResizeListener(),this.element.attr("role")?this.element[0].hasAttribute("tabindex")||this.element.attr("tabindex",0):this.element.attr("tabindex",null)}else this._renderNeeded=!0,this._MakeReady()},_getDataProviderEventHandler:function(t,n){var r=this,i=n[1],o=function(e,t,n){if(!t)return[];var r=new d(t),i=new Map,o=function(e){for(var t=0;t<e.length;t++){var a=n?e[t].value:e[t],s=r.get(a);s!==r.NOT_A_KEY&&i.set(s,t),n&&e[t].children&&o(e[t].children)}};o(e.keys);var a=[];return t.forEach(function(e){a.push(i.get(e))}),a},a=function(e){Promise.all([e,r._getTemplateEngine()]).then(function(e){r._dataProviderState[i].data=e[0],r._dataProviderState[i].pathsValuesMap=null,r._Render()})};return function(t){var s=this,l=e.DataProviderFeatureChecker.isTreeDataProvider(s),h=r._treeKeyDataMap[i];if("refresh"===t.type)a(r._fetchAllData(s,n[1]));else if("mutate"===t.type){var d,u=t.detail.update,_=t.detail.remove,c=t.detail.add,p=r._dataProviderState[n[1]].data,v=function(e,t,i,o){var a=0,d=[],u=1===i&&!o;return t.keys.forEach(function(e){var i,_=o?null:t.data[a];if(l)if(u){var c=h.get(e);c&&(c.data.value=_,i=Promise.resolve({data:c.data,key:h.get(e).key}))}else{var p={value:_},v={value:e},f=s.getChildDataProvider(e);if(f&&!o)i=r._fetchAllData(f,n[1]).then(function(e){return p.children=e.data,v.children=e.keys,{data:p,key:v}});else i=Promise.resolve({data:p,key:v});if(!o){var m=t.parentKeys?t.parentKeys[a]:null;h.set(v.value,{data:p,key:v,parentKey:m})}}else i=Promise.resolve({data:_,key:e}),h.set(e,{data:_,key:e});d.push(i),a+=1}),Promise.all(d).then(function(t){for(var n=t.length-1;n>=0;n--){var r,a,s=l?t[n].key.value:t[n].key,d=h.get(s).parentKey;if(d){var _=h.get(d);_.data.children||u||(_.data.children=[],_.key.children=[]),r=_.data.children,a=_.key.children}else r=p.data,a=p.keys;if(o)r.splice(e[n],i),a.splice(e[n],i);else{var c=u||0!==e.length?e[n]:r.length;r.splice(c,i,t[n].data),a.splice(c,i,t[n].key)}}return p})},f=function(e){return s.fetchByKeys({keys:e}).then(function(t){var n=[];return t.results.size>0&&e.forEach(function(e){n.push(t.results.get(e).data)}),n})},m=Promise.resolve();u&&(d=u.indexes||o(p,u.keys,l),m=Array.isArray(u.data)?v(d,u,1):f(u.keys).then(function(e){var t=Object.create(u,{data:{value:e}});return v(d,t,1)})),m.then(function(){return _?(d=_.indexes||o(p,_.keys,l),v(d,_,1,!0)):Promise.resolve()}).then(function(){return c?(d=c.indexes||o(p,c.addBeforeKeys?c.addBeforeKeys:c.afterKeys,l),Array.isArray(c.data)?v(d,c,0):f(c.keys).then(function(e){var t=Object.create(c,{data:{value:e}});return v(d,t,0)})):Promise.resolve()}).then(function(){a(Promise.resolve(p))})}}},_addDataProviderEventListeners:function(){for(var t=this._GetComponentDeferredDataPaths(),n=Object.keys(t),r=0;r<n.length;r++)for(var i=n[r],o=t[i],a=0;a<o.length;a++){var s,l=o[a];if((s="root"===i?this.options[l]:this.options[i]?this.options[i][l]:null)&&e.DataProviderFeatureChecker.isDataProvider(s)){var h=this._getDataProviderEventHandler(this,[i,l]);s.addEventListener("mutate",h),s.addEventListener("refresh",h),this._dataProviderEventListeners.push({dataProvider:s,listener:h})}}},_removeDataProviderEventListeners:function(){for(var e=0;e<this._dataProviderEventListeners.length;e++){var t=this._dataProviderEventListeners[e],n=t.dataProvider,r=t.listener;n.removeEventListener("mutate",r),n.removeEventListener("refresh",r)}this._dataProviderEventListeners=[]},_GetDataContext:function(e){return{}},_IsFlowingLayoutSupported:function(){return!1},whenReady:function(){if(this._ready)return Promise.resolve(!0);if(!this._promise){var e=this;this._promise=new Promise(function(t){e._promiseResolve=t})}return this._promise},_NotReady:function(){if(this._ready=!1,0===this._numDeferredObjs&&!this._readyResolveFunc){var e=n.getContext(this.element[0]).getBusyContext(),t={description:"The component identified by '"+this.element.attr("id")+"' is being loaded."};this._readyResolveFunc=e.addBusyState(t)}},_MakeReady:function(){this._promiseResolve&&(this._promiseResolve(!0),this._promiseResolve=null),this._ready=!0,this._promise=null,this._readyResolveFunc&&(this._readyResolveFunc(),this._readyResolveFunc=null)},_ProcessOptions:function(){var e=this.options.tooltip;e&&e._renderer&&(this.options.tooltip={renderer:this._GetTemplateRenderer(e._renderer,"tooltip")})},_WrapCustomElementRenderer:function(e){var t=this;return function(n){n._dvtcontext=t._context;var r=e(n);if(n._templateName&&n._templateCleanup&&t._AddTemplate(n._templateName,n._templateCleanup),r&&!0!==r.preventDefault&&r.insert){var i=r.insert;return i.classList&&i.classList.contains("oj-dvtbase")?t._GetDvtComponent(i):i}return null}},_FixCustomRenderers:function(e){if(this._IsCustomElement())for(var t=this._GetComponentRendererOptions(),n=0;n<t.length;n++){var r=t[n],i=new p(e,r),o=i.getValue();o&&i.setValue(this._WrapCustomElementRenderer(o),!0)}},_GetComponentRendererOptions:function(){return["tooltip/renderer"]},_GetTemplateRenderer:function(e,n){var r=this;return function(i){var o=document.createElement("div");o.style.display="none",e({parentElement:o,context:i});var a=o.children[0];return a?(r._AddTemplate(n,function(){t(o).remove()}),o.removeChild(a),t(o).remove(),a):null}},_GetTemplateDataRenderer:function(e,n){var r=this;return function(i){var o=document.createElement("div");o.style.display="none",o._dvtcontext=r._context,r.element.append(o),e({parentElement:o,data:i.data});var a=o.children[0];return a?(r._AddTemplate(n,function(){t(o).remove()}),"http://www.w3.org/2000/svg"===a.namespaceURI?(o.removeChild(a),t(o).remove(),a):r._GetDvtComponent(a)):null}},_CleanAllTemplates:function(){for(var e=Object.keys(this._templateMap),t=0;t<e.length;t++){var n=e[t];this._CleanTemplate(n)}this._templateMap={}},_CleanTemplate:function(e){if(this._templateMap[e]){for(var t=this._templateMap[e].length,n=0;n<t;n++)this._templateMap[e][n]();this._templateMap[e]=[]}},_AddTemplate:function(e,t){this._templateMap[e]||(this._templateMap[e]=[]),this._templateMap[e].push(t)},_CompareOptionValues:function(t,n,r){switch(t){case"hiddenCategories":case"highlightedCategories":case"selection":return e.Object.compareValues(n,r);default:return this._super(t,n,r)}}},!0),c});