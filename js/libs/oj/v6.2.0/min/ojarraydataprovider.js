/**
 * @license
 * Copyright (c) 2014, 2019, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";define(["ojs/ojcore","jquery","knockout","ojs/ojset","ojs/ojmap","ojs/ojeventtarget","ojs/ojdataprovider"],function(t,e,i,n,s){var r=function(){function e(t,e){this.data=t,this.options=e,this._KEY="key",this._KEYS="keys",this._AFTERKEYS="afterKeys",this._ADDBEFOREKEYS="addBeforeKeys",this._DIRECTION="direction",this._ATTRIBUTE="attribute",this._ATTRIBUTES="attributes",this._SORT="sort",this._SORTCRITERIA="sortCriteria",this._DATA="data",this._METADATA="metadata",this._INDEXES="indexes",this._OFFSET="offset",this._SIZE="size",this._IDATTRIBUTE="idAttribute",this._IMPLICITSORT="implicitSort",this._KEYATTRIBUTES="keyAttributes",this._SORTCOMPARATORS="sortComparators",this._COMPARATORS="comparators",this._COMPARATOR="comparator",this._RESULTS="results",this._CONTAINS="contains",this._FETCHPARAMETERS="fetchParameters",this._CONTAINSPARAMETERS="containsParameters",this._VALUE="value",this._DONE="done",this._ADD="add",this._REMOVE="remove",this._UPDATE="update",this._DETAIL="detail",this._FETCHLISTRESULT="fetchListResult",this._ATDEFAULT="@default",this._MUTATIONSEQUENCENUM="mutationSequenceNum",this.Item=function(){return function(t,e,i){this._parent=t,this.metadata=e,this.data=i,this[t._METADATA]=e,this[t._DATA]=i}}(),this.ItemMetadata=function(){return function(t,e){this._parent=t,this.key=e,this[t._KEY]=e}}(),this.FetchByKeysResults=function(){return function(t,e,i){this._parent=t,this.fetchParameters=e,this.results=i,this[t._FETCHPARAMETERS]=e,this[t._RESULTS]=i}}(),this.ContainsKeysResults=function(){return function(t,e,i){this._parent=t,this.containsParameters=e,this.results=i,this[t._CONTAINSPARAMETERS]=e,this[t._RESULTS]=i}}(),this.FetchByOffsetResults=function(){return function(t,e,i,n){this._parent=t,this.fetchParameters=e,this.results=i,this.done=n,this[t._FETCHPARAMETERS]=e,this[t._RESULTS]=i,this[t._DONE]=n}}(),this.FetchListParameters=function(){return function(t,e,i,n){this._parent=t,this.size=e,this.sortCriteria=i,this.attributes=n,this[t._SIZE]=e,this[t._SORTCRITERIA]=i,this[t._ATTRIBUTES]=n}}(),this.FetchListResult=function(){return function(t,e,i,n){this._parent=t,this.fetchParameters=e,this.data=i,this.metadata=n,this[t._FETCHPARAMETERS]=e,this[t._DATA]=i,this[t._METADATA]=n}}(),this.AsyncIterable=function(){return function(t,e){this._parent=t,this._asyncIterator=e,this[Symbol.asyncIterator]=function(){return this._asyncIterator}}}(),this.AsyncIterator=function(){function t(t,e,i,n){this._parent=t,this._nextFunc=e,this._params=i,this._offset=n,this._cachedOffset=n,this._cacheObj={},this._cacheObj[t._MUTATIONSEQUENCENUM]=t._mutationSequenceNum}return t.prototype.next=function(){var t=this._nextFunc(this._params,this._cachedOffset,this._cacheObj);return this._cachedOffset=this._cachedOffset+t.value[this._parent._DATA].length,Promise.resolve(t)},t}(),this.AsyncIteratorResult=function(){return function(t,e,i){this._parent=t,this.value=e,this.done=i,this[t._VALUE]=e,this[t._DONE]=i}}(),this.DataProviderMutationEventDetail=function(){return function(t,e,i,n){this._parent=t,this.add=e,this.remove=i,this.update=n,this[t._ADD]=e,this[t._REMOVE]=i,this[t._UPDATE]=n}}(),this.DataProviderOperationEventDetail=function(){return function(t,e,i,n,s){this._parent=t,this.keys=e,this.metadata=i,this.data=n,this.indexes=s,this[t._KEYS]=e,this[t._METADATA]=i,this[t._DATA]=n,this[t._INDEXES]=s}}(),this.DataProviderAddOperationEventDetail=function(){return function(t,e,i,n,s,r,a){this._parent=t,this.keys=e,this.afterKeys=i,this.addBeforeKeys=n,this.metadata=s,this.data=r,this.indexes=a,this[t._KEYS]=e,this[t._AFTERKEYS]=i,this[t._ADDBEFOREKEYS]=n,this[t._METADATA]=s,this[t._DATA]=r,this[t._INDEXES]=a}}(),this._cachedIndexMap=[],this._sequenceNum=0,this._mutationSequenceNum=0,this._subscribeObservableArray(t),null!=e&&null!=e[this._KEYS]&&(this._keysSpecified=!0,this._keys=e[this._KEYS])}return e.prototype.containsKeys=function(t){var e=this;return this.fetchByKeys(t).then(function(i){var s=new n;return t[e._KEYS].forEach(function(t){null!=i[e._RESULTS].get(t)&&s.add(t)}),Promise.resolve(new e.ContainsKeysResults(e,t,s))})},e.prototype.fetchByKeys=function(e){var i=this;this._generateKeysIfNeeded();var n,r=new s,a=this._getKeys(),o=null!=e?e[this._ATTRIBUTES]:null,u=0;return e[i._KEYS].forEach(function(e){for(n=null,u=0;u<a.length;u++)if(t.Object.compareValues(a[u],e)){n=u;break}if(null!=n&&n>=0){var s=i._getRowData()[n];o&&o.length>0&&(s=i._filterRowAttributes(o,s)),r.set(e,new i.Item(i,new i.ItemMetadata(i,e),s))}}),Promise.resolve(new i.FetchByKeysResults(i,e,r))},e.prototype.fetchByOffset=function(t){var e=this,i=null!=t?t[this._SIZE]:-1,n=null!=t?t[this._SORTCRITERIA]:null,s=null!=t&&t[this._OFFSET]>0?t[this._OFFSET]:0,r=null!=t?t[this._ATTRIBUTES]:null;this._generateKeysIfNeeded();var a=new this.FetchListParameters(this,i,n,r),o=this._fetchFrom(a,s),u=o[this._VALUE],h=o[this._DONE],l=u[this._DATA],_=u[this._METADATA].map(function(t){return t[e._KEY]}),f=l.map(function(t,i){return new e.Item(e,new e.ItemMetadata(e,_[i]),t)});return Promise.resolve(new this.FetchByOffsetResults(this,t,f,h))},e.prototype.fetchFirst=function(t){return new this.AsyncIterable(this,new this.AsyncIterator(this,this._fetchFrom.bind(this),t,0))},e.prototype.getCapability=function(t){return e.getCapability(t)},e.getCapability=function(t){if("sort"==t)return{attributes:"multiple"};if("fetchByKeys"==t)return{implementation:"lookup"};if("fetchByOffset"==t)return{implementation:"randomAccess"};if("fetchCapability"==t){var e=new Set;return e.add("exclusion"),{attributeFilter:{expansion:{},ordering:{},defaultShape:{features:e}}}}return null},e.prototype.getTotalSize=function(){return Promise.resolve(this._getRowData().length)},e.prototype.isEmpty=function(){return this._getRowData().length>0?"no":"yes"},e.prototype.createOptimizedKeySet=function(t){return new n(t)},e.prototype.createOptimizedKeyMap=function(t){if(t){var e=new s;return t.forEach(function(t,i){e.set(i,t)}),e}return new s},e.prototype._getRowData=function(){return this[this._DATA]instanceof Array?this[this._DATA]:this[this._DATA]()},e.prototype._getKeys=function(){return null==this._keys||this._keys instanceof Array?this._keys:this._keys()},e.prototype._indexOfKey=function(e){for(var i=this._getKeys(),n=-1,s=0;s<i.length;s++)if(t.Object.compareValues(i[s],e)){n=s;break}return n},e.prototype._subscribeObservableArray=function(e){if(!(e instanceof Array)){if(!this._isObservableArray(e))throw new Error("Invalid data type. ArrayDataProvider only supports Array or observableArray.");var i=this;e.subscribe(function(e){var s,r,a,o,u,h=[],l=[],_=[],f=[],c=[];i._mutationSequenceNum++;var d=!0,p=!0;e.forEach(function(t){"deleted"===t.status?d=!1:"added"===t.status&&(p=!1)});var E=[],v=[],A=null,y=null,T=null;if(!d&&!p){for(s=0;s<e.length;s++){o=e[s].index,u=e[s].status;var m=i._getId(e[s].value);for(r=0;r<e.length;r++)r!=s&&o===e[r].index&&u!==e[r].status&&E.indexOf(s)<0&&v.indexOf(s)<0&&(null==m||t.Object.compareValues(m,i._getId(e[r].value)))&&("deleted"===u?(v.push(s),E.push(r)):(v.push(r),E.push(s)))}for(s=0;s<e.length;s++)if(E.indexOf(s)>=0){var R=i._getKeys()[e[s].index];l.push(R),h.push(e[s].value),_.push(e[s].index)}if(l.length>0){f=l.map(function(t){return new i.ItemMetadata(i,t)});var S=new n;l.map(function(t){S.add(t)}),A=new i.DataProviderOperationEventDetail(i,S,f,h,_)}}if(h=[],l=[],_=[],!d){for(s=0;s<e.length;s++)"deleted"===e[s].status&&E.indexOf(s)<0&&v.indexOf(s)<0&&(l.push(i._getKeys()[e[s].index]),h.push(e[s].value),_.push(e[s].index));if(l.length>0&&l.map(function(t){var e=i._indexOfKey(t);i._keys.splice(e,1)}),l.length>0){f=l.map(function(t){return new i.ItemMetadata(i,t)});var I=new n;l.map(function(t){I.add(t)}),T=new i.DataProviderOperationEventDetail(i,I,f,h,_)}}if(h=[],l=[],_=[],!p){var g=i._generateKeysIfNeeded(),O=null==i._getKeys()||!(i._getKeys().length>0);for(s=0;s<e.length;s++)if("added"===e[s].status&&E.indexOf(s)<0&&v.indexOf(s)<0){null==(a=i._getId(e[s].value))&&(g||i._keysSpecified)&&(a=i._getKeys()[e[s].index]),null==a&&(a=i._sequenceNum++,i._keys.splice(e[s].index,0,a)),(O||-1==i._indexOfKey(a))&&i._keys.splice(e[s].index,0,a),l.push(a);var D=i._getKeys()[e[s].index+1];D=null==D?null:D,c.push(D),h.push(e[s].value),_.push(e[s].index)}if(l.length>0){f=l.map(function(t){return new i.ItemMetadata(i,t)});var b=new n;l.map(function(t){b.add(t)});var w=new n;c.map(function(t){w.add(t)}),y=new i.DataProviderAddOperationEventDetail(i,b,w,c,f,h,_)}}i._fireMutationEvent(y,T,A)},null,"arrayChange"),e.subscribe(function(e){i._mutationEvent?i.dispatchEvent(i._mutationEvent):i._mutationRemoveEvent||i._mutationAddEvent||i._mutationUpdateEvent?(i._mutationRemoveEvent&&i.dispatchEvent(i._mutationRemoveEvent),i._mutationAddEvent&&i.dispatchEvent(i._mutationAddEvent),i._mutationUpdateEvent&&i.dispatchEvent(i._mutationUpdateEvent)):i.dispatchEvent(new t.DataProviderRefreshEvent),i._mutationEvent=null,i._mutationRemoveEvent=null,i._mutationAddEvent=null,i._mutationUpdateEvent=null},null,"change")}},e.prototype._fireMutationEvent=function(e,i,n){var s=this,r=!1;if(["keys","indexes"].forEach(function(t){r||(r=s._hasSamePropValue(i,e,t)||s._hasSamePropValue(i,n,t)||s._hasSamePropValue(e,n,t))}),r){if(i){var a=new this.DataProviderMutationEventDetail(this,null,i,null);this._mutationRemoveEvent=new t.DataProviderMutationEvent(a)}if(e){var o=new this.DataProviderMutationEventDetail(this,e,null,null);this._mutationAddEvent=new t.DataProviderMutationEvent(o)}if(n){var u=new this.DataProviderMutationEventDetail(this,null,null,n);this._mutationUpdateEvent=new t.DataProviderMutationEvent(u)}}else{var h=new this.DataProviderMutationEventDetail(this,e,i,n);this._mutationEvent=new t.DataProviderMutationEvent(h)}},e.prototype._hasSamePropValue=function(e,i,n){var s=!1;return e&&e[n]&&e[n].forEach(function(e){!s&&i&&i[n]&&i[n].forEach(function(i){!s&&t.Object.compareValues(e,i)&&(s=!0)})}),s},e.prototype._isObservableArray=function(t){return i.isObservable(t)&&!(void 0===t.destroyAll)},e.prototype._generateKeysIfNeeded=function(){if(null==this._keys){var t=null!=this.options?this.options[this._KEYATTRIBUTES]||this.options[this._IDATTRIBUTE]:null;this._keys=[];var e=this._getRowData(),i=void 0,n=0;for(n=0;n<e.length;n++)null!=(i=this._getId(e[n]))&&"@index"!=t||(i=this._sequenceNum++),this._keys[n]=i;return!0}return!1},e.prototype._getId=function(t){var e,i=null!=this.options?this.options[this._KEYATTRIBUTES]||this.options[this._IDATTRIBUTE]:null;if(null!=i){var n;if(Array.isArray(i))for(e=[],n=0;n<i.length;n++)e[n]=this._getVal(t,i[n]);else e="@value"==i?this._getAllVals(t):this._getVal(t,i);return e}return null},e.prototype._getVal=function(t,e){return"function"==typeof t[e]?t[e]():t[e]},e.prototype._getAllVals=function(t){var e=this;return Object.keys(t).map(function(i){return e._getVal(t,i)})},e.prototype._fetchFrom=function(t,e,i){var n=this,s=null!=t?t[this._ATTRIBUTES]:null;this._generateKeysIfNeeded();var r=null!=t?t[this._SORTCRITERIA]:null,a=this._getCachedIndexMap(r,i),o=a.map(function(t){var e=n._getRowData()[t];return s&&s.length>0&&(e=n._filterRowAttributes(s,e)),e}),u=a.map(function(t){return n._getKeys()[t]}),h=null!=t?t[this._SIZE]>0?t[this._SIZE]:t[this._SIZE]<0?n._getKeys().length:25:25,l=o.slice(e,e+h),_=u.slice(e,e+h).map(function(t){return new n.ItemMetadata(n,t)}),f=e+h<o.length,c=this._mergeSortCriteria(r);null!=c&&((t=t||{})[this._SORTCRITERIA]=c);var d=new this.FetchListResult(this,t,l,_);return new this.AsyncIteratorResult(this,d,!f)},e.prototype._getCachedIndexMap=function(t,e){if(e&&e.indexMap&&e[this._MUTATIONSEQUENCENUM]===this._mutationSequenceNum)return e.indexMap;var i=this._getRowData().map(function(t,e){return e}),n=this._sortData(i,t);return e&&(e.indexMap=n,e[this._MUTATIONSEQUENCENUM]=this._mutationSequenceNum),n},e.prototype._sortData=function(t,e){var i=this,n=t.map(function(t){return{index:t,value:i._getRowData()[t]}});return null!=e&&n.sort(this._getSortComparator(e)),n.map(function(t){return t.index})},e.prototype._getSortComparator=function(t){var e=this;return function(i,n){var s,r,a,o,u,h,l=null!=e.options?e.options[e._SORTCOMPARATORS]:null;for(s=0;s<t.length;s++)if(r=t[s][e._DIRECTION],a=t[s][e._ATTRIBUTE],o=null,null!=l&&(o=l[e._COMPARATORS].get(a)),u=e._getVal(i.value,a),h=e._getVal(n.value,a),null!=o){var _="descending"==r?-1:1,f=o(u,h)*_;if(0!=f)return f}else{var c=0,d="string"==typeof u?u:new String(u).toString(),p="string"==typeof h?h:new String(h).toString();if(0!=(c="ascending"==r?d.localeCompare(p,void 0,{numeric:!0,sensitivity:"base"}):p.localeCompare(d,void 0,{numeric:!0,sensitivity:"base"})))return c}return 0}},e.prototype._mergeSortCriteria=function(t){var e=null!=this.options?this.options[this._IMPLICITSORT]:null;if(null!=e){if(null==t)return e;var i=t.slice(0),n=void 0,s=void 0,r=void 0;for(n=0;n<e.length;n++){for(r=!1,s=0;s<i.length;s++)i[s][this._ATTRIBUTE]==e[n][this._ATTRIBUTE]&&(r=!0);r||i.push(e[n])}return i}return t},e.prototype._filterRowAttributes=function(t,e){var i=this,n=null;if(Array.isArray(t)){n={};var s,r=!1;t.forEach(function(t){t!=i._ATDEFAULT&&t.name!=i._ATDEFAULT||(r=!0)}),Object.keys(e).forEach(function(a){if(r){var o=!1,u=a,h=void 0;for(s=0;s<t.length;s++)if((h=t[s]instanceof Object?t[s].name:t[s]).startsWith("!")){if((h=h.substr(1,h.length-1))==a){o=!0;break}}else if(h==a){u=t[s];break}o||(n[a]=i._filterRowAttributes(u,e))}else t.forEach(function(t){var s;(s=t instanceof Object?t.name:t).startsWith("!")||s!=a||(n[s]=i._filterRowAttributes(t,e))})})}else if(t instanceof Object){var a=t.name,o=t.attributes;a&&!a.startsWith("!")&&(e[a]instanceof Object&&!Array.isArray(e[a])?n=i._filterRowAttributes(o,e[a]):Array.isArray(e[a])?(n=[],e[a].forEach(function(t,e){n[e]=i._filterRowAttributes(o,t)})):n=e[a])}else n=e[t];return n},e}();return t.ArrayDataProvider=r,t.EventTargetMixin.applyMixin(r),r});